---
title: 类加载过程
tags: java
grammar_cjkRuby: true
---

### 类加载的生命周期
加载、验证、准备、解析、初始化、使用和卸载7个阶段

### 类初始化条件
1.使用new类实例化对象、读取类的静态方法或字段（final修饰的静态字段除外）
2.使用java.lang.reflect包的方法对类进行反射调用
3.初始化子类，其父类没有初始化，则先初始化父类
4.虚拟机启动时，用户指定一个执行的主类，虚拟机会先初始化这个主类
5.使用JDK1.7的动态语言支持时，如果一个java.lang.invoke.MethodHandle实例最后的解析结果REF_getStatic、REF_putStatic、REF_invokeStatic的方法句柄，并且这个方法句柄所对应的类没有进行过初始化，则需要先触发器初始化

*接口与类有所区别是第三条，接口只有真正使用到父接口的时候才会初始化 *
### 加载
- 通过一个类的全限定名来获取定义此类的二进制字节流
- 将这个字节流所代表的静态存储结构转换为方法去的运行时数据结构
- 在内存中生成一个代表这个类的java.lang.Class对象，作为方法区这个类的各种数据访问入口

### 验证
- 文件格式验证
- 元数据验证
- 字节码验证
- 符号引用验证

### 准备
> 正式为类变量分配内存并设置类变量初始值的阶段

*内存分配仅包括类变量，不包括实例变量
  初始值为零值，final修饰的除外*
  
  ### 解析
  - 类或接口的解析
  - 字段解析
  - 类方法解析
  - 接口方法解析

